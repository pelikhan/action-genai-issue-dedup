# action action

This script checks if an issue is a duplicate of another issue in the same repository.

> [!NOTE]
> This action uses [GitHub Models](https://github.com/models) for LLM inference.


## Algorithm

The deduplication algorithm implemented in `genaisrc/action.genai.mts` operates as follows:

- **Issue Retrieval**: The script retrieves the current issue and a configurable set of other issues from the repository, filtered by state, labels, creation date, and count. The current issue is excluded from the comparison set.

- **Prompt Construction**: For each group of issues, the script constructs a prompt that defines the current issue and the group of other issues (grouped to fit in the context window). The prompt instructs the LLM to compare the current issue against each candidate, providing a CSV output with the issue number, reasoning, and a verdict (`DUP` for duplicate, `UNI` for unique).

- **LLM Evaluation**: The prompt is sent to the LLM, which returns a CSV-formatted response. The script parses this response to identify which issues are considered duplicates based on the verdict column.

- **Duplicate Aggregation**: The process continues in groups until the configured maximum number of duplicates (`maxDuplicates`) is found or all candidate issues are processed.

- **Result Output**: If duplicates are found, their issue numbers and titles are output. If no duplicates are found, the action is cancelled with an appropriate message.

This approach leverages LLM reasoning to semantically compare issues, providing scalable and context-aware deduplication within the constraints of API limits and token budgets.

## Inputs

- `count`: Number of issues to check for duplicates (default: `30`)
- `since`: Only check issues created after this date (ISO 8601 format)
- `labels`: List of labels to filter issues by
- `state`: State of the issues to check (open, closed, all) (default: `open`)
- `max_duplicates`: Maximum number of duplicates to check for (default: `3`)
- `tokens_per_issue`: Number of tokens to use for each issue when checking for duplicates (default: `1000`)
- `github_token`: GitHub token with `models: read` permission at least (https://microsoft.github.io/genaiscript/reference/github-actions/#github-models-permissions). (required)
- `debug`: Enable debug logging (https://microsoft.github.io/genaiscript/reference/scripts/logging/).

## Usage

Add the following to your step in your workflow file:

```yaml
...
permissions:
  models: read
  issues: write
...
    steps:
      - uses: pelikhan/action-genai-issue-dedup@v0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          github_issue: ${{ github.event.issue.number }}
```

## Example

```yaml
name: GenAI Find Duplicate Issues
on:
  workflow_dispatch:
    inputs:
      issue_number:
        type: number
        description: 'Issue number to process'
        required: true
  issues:
    types: [opened, reopened]
permissions:
  models: read
  issues: write
concurrency:
  group: ${{ github.workflow }}-${{ github.event.issue.number }}
  cancel-in-progress: true
jobs:
  genai-issue-dedup:
    runs-on: ubuntu-latest
    steps:
      - name: Run action-issue-dedup Action
        uses: pelikhan/action-genai-issue-dedup@v0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          github_issue: ${{ github.event.issue.number }}
```

## Development

This action was automatically generated by GenAIScript from the script metadata.
We recommend updating the script metadata instead of editing the action files directly.

- the action inputs are inferred from the script parameters
- the action outputs are inferred from the script output schema
- the action description is the script title
- the readme description is the script description
- the action branding is the script branding

To **regenerate** the action files (`action.yml`, `Dockerfile`, `README.md`, `package.json`, `.gitignore`), run:

```bash
npm run configure
```

> [!CAUTION]
> This will overwrite any changes you made to these files!

To lint script files, run:

```bash
npm run lint
```

To typecheck the scripts, run:
```bash
npm run typecheck
```

To build the Docker image locally, run:
```bash
npm run docker:build
```

To run the action locally in Docker (build it first), use:
```bash
npm run docker:start
```

To run the action using [act](https://nektosact.com/), first install the act CLI:

```bash
npm run act:install
```

Then, you can run the action with:

```bash
npm run act
```

## Upgrade

The GenAIScript version is pinned in the `package.json` file. To upgrade it, run:

```bash
npm run upgrade
```

## Release

To release a new version of this action, run the release script on a clean working directory.

```bash
npm run release
```
